#!/bin/sh

# Get the list of staged files
files=$(git diff --cached --name-only)

echo "ğŸ” Running TypeScript type check before commit..."
pnpm run type-check || exit 1
echo "âœ… TypeScript check passed!"

echo "ğŸ¨ Running lint-staged on staged files..."
pnpm run format:staged || exit 1
echo "âœ… Linting and formatting completed!"

# Check if any test files are in staging area
test_files=$(echo "$files" | grep -E '\.(test|spec)\.(ts|tsx|js|jsx)$' || true)

if [ -n "$test_files" ]; then
    echo "ğŸ§ª Running tests for staged test files..."
    for test_file in $test_files; do
        echo "ğŸ” Running: $test_file"
        pnpm test "$test_file" --passWithNoTests || {
            echo "âŒ Test failed: $test_file"
            exit 1
        }
    done
    echo "âœ… All staged tests passed!"
else
    echo "â„¹ï¸  No test files in staging area, skipping tests"
fi

echo "ğŸ‰ Pre-commit checks completed successfully!"